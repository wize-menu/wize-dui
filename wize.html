<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wize Menu</title>
    <link rel="stylesheet" href="tailwind.css">
    <style>
        body {
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: 'Arial', sans-serif;
            user-select: none;
            overflow: hidden;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .neon-text {
            text-shadow: 0 0 5px #0ff, 0 0 10px #0ff, 0 0 20px #0ff;
        }
        .neon-border {
            box-shadow: 0 0 5px #0ff, 0 0 10px #0ff;
        }
        .tab-button.active {
            background-color: #0ff;
            color: #1a1a1a;
            font-weight: bold;
        }
        input, button {
            transition: all 0.2s ease;
        }
        button:hover {
            background-color: #0cc;
        }
        input[type="range"] {
            accent-color: #0ff;
        }
        input[type="checkbox"] {
            accent-color: #0ff;
        }
    </style>
</head>
<body class="flex flex-col items-center h-screen p-4">
    <h1 class="text-3xl font-bold neon-text mb-4">Wize Menu</h1>
    <div class="flex space-x-2 mb-4">
        <!-- Tab Navigation -->
        <div id="tabs" class="flex space-x-1"></div>
    </div>
    <div id="content" class="w-3/4 max-w-4xl bg-gray-800 p-4 rounded-lg neon-border">
        <!-- Dynamic Content -->
    </div>

    <script>
        // State to hold menu data
        let menuState = {
            activeTab: 0,
            tabs: [],
            selection: { index: 0 },
            isTyping: false,
            isContentPanelOpen: false
        };

        // Render tabs
        function renderTabs() {
            const tabsContainer = document.getElementById('tabs');
            tabsContainer.innerHTML = '';
            menuState.tabs.forEach((tab, index) => {
                const tabButton = document.createElement('button');
                tabButton.className = `px-4 py-2 rounded-md ${menuState.activeTab === index ? 'tab-button active' : 'bg-gray-700'}`;
                tabButton.textContent = tab.title;
                tabButton.onclick = () => {
                    window.postMessage({ type: 'key', key: menuState.activeTab > index ? 0x26 : 0x28 });
                };
                tabsContainer.appendChild(tabButton);
            });
        }

        // Render content based on active tab
        function renderContent() {
            const contentContainer = document.getElementById('content');
            contentContainer.innerHTML = '';
            const activeTab = menuState.tabs[menuState.activeTab];
            if (!activeTab) return;

            // Header
            const header = document.createElement('h2');
            header.className = 'text-xl font-semibold mb-2';
            header.textContent = activeTab.header;
            contentContainer.appendChild(header);

            // Items
            if (menuState.isContentPanelOpen) {
                activeTab.items.forEach((item, index) => {
                    const isSelected = index === menuState.selection.index;
                    const itemContainer = document.createElement('div');
                    itemContainer.className = `mb-2 ${isSelected ? 'border border-cyan-500 p-1 rounded' : ''}`;

                    if (item.type === 'button') {
                        const button = document.createElement('button');
                        button.className = `w-full py-2 px-4 rounded-md ${isSelected ? 'bg-cyan-500 text-black' : 'bg-gray-600'} text-left`;
                        button.textContent = item.label + (item.state ? ` [${item.state.toUpperCase()}]` : '');
                        button.onclick = () => {
                            if (isSelected) {
                                window.postMessage({ type: 'key', key: 0x0D });
                            } else {
                                window.postMessage({ type: 'key', key: 0x28 });
                            }
                        };
                        itemContainer.appendChild(button);
                    } else if (item.type === 'input') {
                        const label = document.createElement('label');
                        label.className = 'block text-sm';
                        label.textContent = item.label;
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = item.value || '';
                        input.placeholder = item.placeholder || '';
                        input.className = `w-full p-2 rounded-md bg-gray-700 border ${isSelected ? 'border-cyan-500' : 'border-gray-500'}`;
                        input.disabled = !menuState.isTyping || !isSelected;
                        input.oninput = (e) => {
                            menuState.tabs[menuState.activeTab].items[index].value = e.target.value;
                            window.postMessage({ type: 'input_change', tab: menuState.activeTab, index: index, value: e.target.value });
                        };
                        input.onfocus = () => {
                            if (isSelected && !menuState.isTyping) {
                                window.postMessage({ type: 'key', key: 0x0D });
                            }
                        };
                        itemContainer.appendChild(label);
                        itemContainer.appendChild(input);
                    } else if (item.type === 'label') {
                        const label = document.createElement('div');
                        label.className = `py-1 ${isSelected ? 'text-cyan-500' : ''}`;
                        label.textContent = item.label;
                        itemContainer.appendChild(label);
                    } else if (item.type === 'slider') {
                        const label = document.createElement('label');
                        label.className = 'block text-sm';
                        label.textContent = item.label;
                        const slider = document.createElement('input');
                        slider.type = 'range';
                        slider.min = item.min || 0;
                        slider.max = item.max || 100;
                        slider.value = item.value || 50;
                        slider.step = item.step || 1;
                        slider.className = 'w-full';
                        slider.onchange = (e) => {
                            window.postMessage({ type: 'slider_change', tab: menuState.activeTab, index: index, value: parseFloat(e.target.value) });
                        };
                        const valueDisplay = document.createElement('span');
                        valueDisplay.textContent = `${slider.value}${item.unit || ''}`;
                        slider.oninput = (e) => {
                            valueDisplay.textContent = `${e.target.value}${item.unit || ''}`;
                        };
                        itemContainer.appendChild(label);
                        itemContainer.appendChild(slider);
                        itemContainer.appendChild(valueDisplay);
                    } else if (item.type === 'checkbox') {
                        const checkboxContainer = document.createElement('div');
                        checkboxContainer.className = 'flex items-center';
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.checked = item.checked || false;
                        checkbox.className = 'mr-2';
                        checkbox.onchange = (e) => {
                            window.postMessage({ type: 'checkbox_toggle', tab: menuState.activeTab, index: index, checked: e.target.checked });
                        };
                        const label = document.createElement('label');
                        label.textContent = item.label;
                        checkboxContainer.appendChild(checkbox);
                        checkboxContainer.appendChild(label);
                        itemContainer.appendChild(checkboxContainer);
                    }

                    contentContainer.appendChild(itemContainer);
                });
            } else {
                if (activeTab.type === 'grid') {
                    const grid = document.createElement('div');
                    grid.className = 'grid grid-cols-2 gap-2';
                    activeTab.items.forEach((item) => {
                        const button = document.createElement('button');
                        button.className = 'py-2 px-4 bg-gray-600 rounded-md text-left';
                        button.textContent = item.label;
                        button.onclick = () => {
                            window.postMessage({ type: 'key', key: 0x0D });
                        };
                        grid.appendChild(button);
                    });
                    contentContainer.appendChild(grid);
                } else if (activeTab.type === 'list') {
                    activeTab.items.forEach((item) => {
                        const label = document.createElement('div');
                        label.className = 'py-1';
                        label.textContent = item.label;
                        contentContainer.appendChild(label);
                    });
                } else if (activeTab.type === 'form') {
                    activeTab.items.forEach((item, index) => {
                        const itemContainer = document.createElement('div');
                        itemContainer.className = 'mb-2';

                        if (item.type === 'button') {
                            const button = document.createElement('button');
                            button.className = 'w-full py-2 px-4 bg-gray-600 rounded-md text-left';
                            button.textContent = item.label + (item.state ? ` [${item.state.toUpperCase()}]` : '');
                            button.onclick = () => {
                                window.postMessage({ type: 'key', key: 0x0D });
                            };
                            itemContainer.appendChild(button);
                        } else if (item.type === 'input') {
                            const label = document.createElement('label');
                            label.className = 'block text-sm';
                            label.textContent = item.label;
                            const input = document.createElement('input');
                            input.type = 'text';
                            input.value = item.value || '';
                            input.placeholder = item.placeholder || '';
                            input.className = 'w-full p-2 rounded-md bg-gray-700 border border-gray-500';
                            input.disabled = true;
                            itemContainer.appendChild(label);
                            itemContainer.appendChild(input);
                        } else if (item.type === 'label') {
                            const label = document.createElement('div');
                            label.className = 'py-1';
                            label.textContent = item.label;
                            itemContainer.appendChild(label);
                        } else if (item.type === 'slider') {
                            const label = document.createElement('label');
                            label.className = 'block text-sm';
                            label.textContent = item.label;
                            const slider = document.createElement('input');
                            slider.type = 'range';
                            slider.min = item.min || 0;
                            slider.max = item.max || 100;
                            slider.value = item.value || 50;
                            slider.step = item.step || 1;
                            slider.className = 'w-full';
                            slider.disabled = true;
                            const valueDisplay = document.createElement('span');
                            valueDisplay.textContent = `${slider.value}${item.unit || ''}`;
                            itemContainer.appendChild(label);
                            itemContainer.appendChild(slider);
                            itemContainer.appendChild(valueDisplay);
                        } else if (item.type === 'checkbox') {
                            const checkboxContainer = document.createElement('div');
                            checkboxContainer.className = 'flex items-center';
                            const checkbox = document.createElement('input');
                            checkbox.type = 'checkbox';
                            checkbox.checked = item.checked || false;
                            checkbox.className = 'mr-2';
                            checkbox.disabled = true;
                            const label = document.createElement('label');
                            label.textContent = item.label;
                            checkboxContainer.appendChild(checkbox);
                            checkboxContainer.appendChild(label);
                            itemContainer.appendChild(checkboxContainer);
                        }

                        contentContainer.appendChild(itemContainer);
                    });
                }
            }
        }

        // Handle DUI messages from Lua
        window.addEventListener('message', (event) => {
            const data = event.data;
            if (data.action === 'update') {
                menuState = data.data;
                renderTabs();
                renderContent();
            }
        });

        // Initial render
        renderTabs();
        renderContent();
    </script>
</body>
</html>